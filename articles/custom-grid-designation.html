<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Grid designation for custom datasets ‚Ä¢ gcube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Grid designation for custom datasets">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gcube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/gcube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Grid designation for custom datasets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/gcube/blob/main/vignettes/articles/custom-grid-designation.Rmd" class="external-link"><code>vignettes/articles/custom-grid-designation.Rmd</code></a></small>
      <div class="d-none name"><code>custom-grid-designation.Rmd</code></div>
    </div>

    
    
<p>This tutorial explains how spatial grid designation is performed in
ecological datasets using the <strong>gcube</strong> package. We begin
with the theoretical foundations of generating random points within
uncertainty buffers and follow with a practical example of applying a
uniform grid to a real dataset. The method supports both projected and
geographic coordinate reference systems, making it applicable beyond
simulated data.</p>
<div class="section level2">
<h2 id="method">Method<a class="anchor" aria-label="anchor" href="#method"></a>
</h2>
<p>To generate a point within a circle of radius
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
around a central coordinate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo>,</mo><msub><mi>y</mi><mn>0</mn></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_0, y_0)</annotation></semantics></math>,
we use polar coordinates and convert to Cartesian coordinates.</p>
<ol style="list-style-type: decimal">
<li>Sample a <strong>random angle</strong> from the uniform distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùí∞</mi><annotation encoding="application/x-tex">\mathcal{U}</annotation></semantics></math>:</li>
</ol>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ∏</mi><mo>‚àº</mo><mi>ùí∞</mi><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>2</mn><mi>œÄ</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\theta \sim \mathcal{U}(0, 2\pi)
</annotation></semantics></math></p>
<ol start="2" style="list-style-type: decimal">
<li>Sample a <strong>random radius</strong> scaled by square root to
ensure uniform point density:</li>
</ol>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mo>‚Ä≤</mo></msup><mo>=</mo><msqrt><mrow><mi>ùí∞</mi><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msqrt><mo>‚ãÖ</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">
r' = \sqrt{\mathcal{U}(0, 1)} \cdot r
</annotation></semantics></math></p>
<ol start="3" style="list-style-type: decimal">
<li>Convert to Cartesian coordinates:</li>
</ol>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msup><mi>r</mi><mo>‚Ä≤</mo></msup><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
x = x_0 + r' \cos(\theta)
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><msup><mi>r</mi><mo>‚Ä≤</mo></msup><mi>sin</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
y = y_0 + r' \sin(\theta)
</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="coordinate-reference-system-considerations">Coordinate Reference System Considerations<a class="anchor" aria-label="anchor" href="#coordinate-reference-system-considerations"></a>
</h2>
<p>The method of applying the above formula depends on the unit system
of your CRS.</p>
<div class="section level3">
<h3 id="projected-crs-e-g--utm">Projected CRS (e.g., UTM)<a class="anchor" aria-label="anchor" href="#projected-crs-e-g--utm"></a>
</h3>
<p>Projected systems use <strong>meters</strong> or other linear units,
so the polar formula can be applied directly.</p>
<table class="table">
<thead><tr class="header">
<th>Quantity</th>
<th>Formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
offset</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>r</mi><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">x = x_0 + r \cos(\theta)</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
offset</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>r</mi><mi>sin</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">y = y_0 + r \sin(\theta)</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<p>This is the most accurate and straightforward method and should be
used whenever your data are in a projected CRS.</p>
</div>
<div class="section level3">
<h3 id="geographic-crs-e-g--wgs84">Geographic CRS (e.g., WGS84)<a class="anchor" aria-label="anchor" href="#geographic-crs-e-g--wgs84"></a>
</h3>
<p>Geographic systems use <strong>degrees</strong>, not meters.
Therefore, the uncertainty radius in meters must be converted to degrees
using approximations based on latitude:</p>
<ul>
<li>1 degree of latitude ‚âà 111,320 meters</li>
<li>1 degree of longitude ‚âà
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>111</mn><mo>,</mo><mn>320</mn><mo>‚ãÖ</mo><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mtext mathvariant="normal">latitude</mtext><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">111{,}320 \cdot \cos(\text{latitude})</annotation></semantics></math>
meters</li>
</ul>
<p>Use these formulas to convert meters to degrees:</p>
<table class="table">
<colgroup>
<col width="52%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>Quantity</th>
<th>Formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Latitude offset</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Œî</mi><mtext mathvariant="normal">lat</mtext><mo>=</mo><mstyle displaystyle="true"><mfrac><mrow><mi>r</mi><mi>sin</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="false" form="postfix">)</mo></mrow><mn>111320</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\Delta \text{lat} = \dfrac{r \sin(\theta)}{111320}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>Longitude offset</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Œî</mi><mtext mathvariant="normal">lon</mtext><mo>=</mo><mstyle displaystyle="true"><mfrac><mrow><mi>r</mi><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="false" form="postfix">)</mo></mrow><mrow><mn>111320</mn><mo>‚ãÖ</mo><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false" form="prefix">(</mo><mtext mathvariant="normal">lat</mtext><mo stretchy="false" form="postfix">)</mo></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\Delta \text{lon} = \dfrac{r \cos(\theta)}{111320 \cdot \cos(\text{lat})}</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<p>These are <strong>approximations</strong> and may introduce
distortion, especially at high latitudes.</p>
<blockquote>
<p>‚ö†Ô∏è <strong>Tip</strong>: Always prefer using a projected CRS (like
UTM) for grid designation when available. This minimizes distortion and
simplifies calculations. Use geographic CRS (e.g., WGS84) only if your
dataset explicitly requires it or no projected CRS is available.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="getting-started-with-gcube">Getting started with gcube<a class="anchor" aria-label="anchor" href="#getting-started-with-gcube"></a>
</h2>
<p>In this example, we show how <strong>gcube</strong> can be used to
perform grid designation on a custom ecological dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/gcube" class="external-link">gcube</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span> <span class="co"># Load example dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># Data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>           <span class="co"># Working with spatial data</span></span></code></pre></div>
<div class="section level3">
<h3 id="get-example-data">Get example data<a class="anchor" aria-label="anchor" href="#get-example-data"></a>
</h3>
<p>As reference grid, we load the the MGRS grid at 10 km scale from the
<strong>b3data</strong> data package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data from repository</span></span>
<span><span class="va">mgrs10_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/mgrs10_refgrid_belgium.gpkg"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mgrs10_belgium</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 460000.1 ymin: 5620000 xmax: 480000.1 ymax: 5670000</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">#&gt;   mgrscode                           geom</span></span>
<span><span class="co">#&gt; 1  31UDS65 POLYGON ((470000.1 5651000,...</span></span>
<span><span class="co">#&gt; 2  31UDS66 POLYGON ((470000.1 5661000,...</span></span>
<span><span class="co">#&gt; 3  31UDS72 POLYGON ((480000 5621000, 4...</span></span>
<span><span class="co">#&gt; 4  31UDS73 POLYGON ((480000.1 5631000,...</span></span>
<span><span class="co">#&gt; 5  31UDS74 POLYGON ((480000.1 5641000,...</span></span>
<span><span class="co">#&gt; 6  31UDS75 POLYGON ((480000.1 5651000,...</span></span></code></pre></div>
<p>Consider the following synthetic observation dataset with three
species observed across three different years. Each row represents a
record with spatial coordinates and an associated uncertainty in meters.
Both the reference grid and observation data use the same projected CRS,
which ensures that distances and buffer sizes are accurately
computed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate 9 observation records: 3 species x 3 years</span></span>
<span><span class="va">example_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species1"</span>, <span class="st">"species2"</span>, <span class="st">"species3"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  time_point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">:</span><span class="fl">2022</span>, times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">5683521</span>, <span class="fl">5613261</span>, <span class="fl">5533663</span>,</span>
<span>    <span class="fl">5672768</span>, <span class="fl">5559184</span>, <span class="fl">5670045</span>,</span>
<span>    <span class="fl">5628962</span>, <span class="fl">5651001</span>, <span class="fl">5587280</span></span>
<span>  <span class="op">)</span>,</span>
<span>  long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">512309.4</span>, <span class="fl">560722.6</span>, <span class="fl">700880.4</span>,</span>
<span>    <span class="fl">649960.8</span>, <span class="fl">688510.1</span>, <span class="fl">641283.4</span>,</span>
<span>    <span class="fl">502044.7</span>, <span class="fl">568593.9</span>, <span class="fl">566011.5</span></span>
<span>  <span class="op">)</span>,</span>
<span>  coordinateUncertaintyInMeters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">1000</span>, <span class="fl">2500</span>, <span class="fl">5000</span>,</span>
<span>    <span class="fl">1500</span>, <span class="fl">10000</span>, <span class="fl">8000</span>,</span>
<span>    <span class="fl">4000</span>, <span class="fl">2500</span>, <span class="fl">3500</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mgrs10_belgium</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">example_data</span></span>
<span><span class="co">#&gt; Simple feature collection with 9 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 502044.7 ymin: 5533663 xmax: 700880.4 ymax: 5683521</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">#&gt;    species time_point coordinateUncertaintyInMeters                 geometry</span></span>
<span><span class="co">#&gt; 1 species1       2020                          1000 POINT (512309.4 5683521)</span></span>
<span><span class="co">#&gt; 2 species1       2021                          2500 POINT (560722.6 5613261)</span></span>
<span><span class="co">#&gt; 3 species1       2022                          5000 POINT (700880.4 5533663)</span></span>
<span><span class="co">#&gt; 4 species2       2020                          1500 POINT (649960.8 5672768)</span></span>
<span><span class="co">#&gt; 5 species2       2021                         10000 POINT (688510.1 5559184)</span></span>
<span><span class="co">#&gt; 6 species2       2022                          8000 POINT (641283.4 5670045)</span></span>
<span><span class="co">#&gt; 7 species3       2020                          4000 POINT (502044.7 5628962)</span></span>
<span><span class="co">#&gt; 8 species3       2021                          2500 POINT (568593.9 5651001)</span></span>
<span><span class="co">#&gt; 9 species3       2022                          3500 POINT (566011.5 5587280)</span></span></code></pre></div>
<p>We visualise the data with uncertainty circles.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create sf object with uncertainty circles</span></span>
<span><span class="va">buffered_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>  <span class="va">example_data</span>,</span>
<span>  <span class="va">example_data</span><span class="op">$</span><span class="va">coordinateUncertaintyInMeters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">buffered_observations</span>,</span>
<span>          fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"firebrick"</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">example_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="custom-grid-designation_files/figure-html/unnamed-chunk-5-1.png" alt="Visualisation of example dataset" width="700"></p>
</div>
<div class="section level3">
<h3 id="grid-designation">Grid designation<a class="anchor" aria-label="anchor" href="#grid-designation"></a>
</h3>
<p>To perform grid designation, we iterate over each species, filter the
corresponding observations, and apply <code><a href="../reference/grid_designation.html">grid_designation()</a></code> to
generate a species-specific data cube.<br>
For improved performance, especially with larger datasets, consider
using vectorized approaches such as <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> or
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> instead of explicit loops.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get species</span></span>
<span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create empty list</span></span>
<span><span class="va">occurrence_cube_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop over species</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get species</span></span>
<span>  <span class="va">taxon</span> <span class="op">&lt;-</span> <span class="va">taxa</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Filter data</span></span>
<span>  <span class="va">taxon_data</span> <span class="op">&lt;-</span> <span class="va">example_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon</span> <span class="op">==</span> <span class="va">species</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Perform grid designation</span></span>
<span>  <span class="va">taxon_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_designation.html">grid_designation</a></span><span class="op">(</span></span>
<span>    observations <span class="op">=</span> <span class="va">taxon_data</span>,</span>
<span>    grid <span class="op">=</span> <span class="va">mgrs10_belgium</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">123</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Add species column</span></span>
<span>  <span class="va">taxon_cube</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="va">taxon</span></span>
<span></span>
<span>  <span class="co"># Add species cube to list</span></span>
<span>  <span class="va">occurrence_cube_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">taxon_cube</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine species cubes</span></span>
<span><span class="va">occurrence_cube_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">occurrence_cube_list</span><span class="op">)</span></span></code></pre></div>
<p>We select the occupied grid cells.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occurrence_cube_df</span> <span class="op">&lt;-</span> <span class="va">occurrence_cube_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>We visualise the final occurrence cube. Since we have only three
species occurrences per year spread over the whole grid, we see three
occupied grid cells per year.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">occurrence_cube_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">time_point</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="custom-grid-designation_files/figure-html/unnamed-chunk-8-1.png" alt="Visualisation of example data cube" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
