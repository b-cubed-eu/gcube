---
title: "4. Creating cubes for multiple species"
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The workflow for simulating a biodiversity data cubes is provided in tutorials 1-3.
However, this workflow only describes a data cube for a single species.
As such, it is not really a cube since it is not three-dimensional.
Furthermore, many biodiversity indicators are calculated over multiple species.

This tutorial describes the functions provided to simulate biodiversity data cubes for multiple species directly.

```{r setup, warning=FALSE, message=FALSE}
# Load packages
library(gcube)

library(sf)        # work with spatial objects
library(dplyr)     # data wrangling
library(ggplot2)   # data visualisation
```

# Spatial extend

As input, we create a polygon in which we simulate occurrences.

```{r}
polygon <- st_polygon(list(cbind(c(500, 1000, 1000, 600, 200, 100, 500),
                                 c(200, 100, 700, 1000, 900, 500, 200))))
```

The polygon looks like this.

```{r}
#| fig.alt: >
#|   Spatial extend in which we will simulate species occurrences.
ggplot() +
  geom_sf(data = polygon) +
  theme_minimal()
```

Also consider a road across our polygon.

```{r}
# Define the road width
road_width <- 50

# Create road points
road_points <- rbind(c(100, 500), c(1000, 500))

# Create road-like polygon within the given polygon
road_polygon <- st_linestring(road_points) %>%
  st_buffer(road_width) %>%
  st_intersection(polygon) %>%
  st_polygon() %>%
  st_sfc() %>%
  st_as_sf() %>%
  rename(geometry = x)
```

The result looks like this.

```{r}
#| fig.alt: >
#|   Spatial extend with road in which we will simulate species occurrences.
ggplot() +
  geom_sf(data = polygon, fill = "lightgreen") +
  geom_sf(data = road_polygon) +
  theme_minimal()
```

